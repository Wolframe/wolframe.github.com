<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2.6. Step 6 - Show customer</title><link rel="stylesheet" type="text/css" href="/layout/styles/main.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Wolframe Tutorial (NOT UP TO DATE!!)" /><link rel="up" href="bk01ch02.html" title="Chapter 2. Steps" /><link rel="prev" href="bk01ch02s05.html" title="2.5. Step 5 - Implement client side customer list" /><link rel="next" href="bk01ch02s07.html" title="2.7. Step 7 - Editing customer" />
	<title xmlns="">Project Wolframe</title>
	<meta xmlns="" charset="utf-8" />
	<meta xmlns="" name="viewport" content="width=device-width, initial-scale=1.0" />

	<link xmlns="" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

	<link xmlns="" href="/layout/styles/main.css" rel="stylesheet" type="text/css" media="all" />
	<link xmlns="" href="/layout/styles/mediaqueries.css" rel="stylesheet" type="text/css" media="all" />

	<!--[if lt IE 9]>
		<link href="/layout/styles/ie/ie8.css" rel="stylesheet" type="text/css" media="all" />
		<script src="/layout/scripts/ie/css3-mediaqueries.min.js"></script>
		<script src="/layout/scripts/ie/html5shiv.min.js"></script>
	<![endif]-->


</head><body>


<div xmlns="" class="wrapper row1">
	<header id="header" class="full_width clear">
		<div id="header-logo">
			<h1><a href="/index.html">Project Wolframe</a></h1>
			<h2>The Straight Path to Successful Projects</h2>
		</div>
		<div id="header-search">
			<form id="cse-search-box" action="http://www.wolframe.net/gsearch.html">
				<input type="hidden" name="cx" value="007231504736047898702:wrnjvfljzvu" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
<!--				<input type="submit" name="sa" value="&#xf002;" /> -->
				<input type="submit" name="sa" class="search-bttn" value="" />
			</form>
		</div>
	</header>
</div>

<!-- ################################################################################################ -->
<div xmlns="" class="wrapper row2">
	<nav id="topnav">
		<ul class="clear">
<!-- BEGIN MENU -->
			<li><a href="/index.html" title="Home">Home</a></li>
			<li><a href="/downloads.html" title="Downloads">Downloads</a></li>
			<li class="active"><a href="/documentation.html" title="Documentation">Documentation</a></li>
			<li><a class="drop" href="/support.html" title="Support">Support</a>
				<ul>
					<li><a href="/faqs.html" title="FAQ">FAQ</a></li>
					<li><a href="http://sourceforge.net/p/wolframe/mailman/" title="Mailing lists">Mailing lists</a></li>
				</ul>
			</li>
			<li class="last-child"><a href="/contact.html" title="Contact Us">Contact Us</a></li>
<!-- END MENU -->
		</ul>
	</nav>
</div>

<!-- ################################################################################################ -->
<div class="wrapper row3"><div id="container"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.6. Step 6 - Show customer</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk01ch02s05.html">Prev</a> </td><th width="60%" align="center">Chapter 2. Steps</th><td width="20%" align="right"> <a accesskey="n" href="bk01ch02s07.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idm139948739680704"></a>2.6. Step 6 - Show customer</h2></div></div></div><p>
		As next step we want to show how data is communicated between the forms
		by implementing a simple "show me customer data" use case.
	</p><p>
		Let's start by adding a button in <code class="filename">customers.ui</code> called 'Show':
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_show_button_form_prop.png" /></div></div><p>
		We add dynamic properties, one is the 'form' which we set to 'customer_show'.
	</p><p>
		We also add some signals for the double click on the customer list to
		click the "Show" button:
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customers_signals.png" /></div></div><p>
		We want the currently selected customer to be accessible in the
		<code class="filename">customer_show.ui</code> form, so we have to remember
		the current selection of the <code class="classname">QTreeWidget</code>
		named 'customer' as global variable 'id'. We add a dynamic property
		with the name 'global.id' and the value '{customer.id}':
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customers_edit_button_props.png" /></div></div><p>
		Now of course we have to create a new form called <code class="filename">customer_show.ui</code>. We
		choose a form layout and add two fields with labels 'Name:' and 'Address:'
		and each of them having a <code class="classname">QLineEdit</code> widget. The names of the widgets
		should be 'name' and 'address' in order to match the future read request
		from the server. Temporarily we also add an 'id' field which shows us
		the current value of 'global.id':
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customer_show_id.png" /></div></div><p>
		Finally we also need a button which brings us back to the customer list
		by simply adding a 'form' action with the value 'customers':
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customer_show_back_button.png" /></div></div><p>
		If we start the wolfclient and select a customer and press 'Show' we will
		notice that the whole "Show Customer" form is empty, even the id. What's
		wrong? Well, the widgets in wolfclient have the default behaviour of using
		'id' attributes attached to the colums of a list for instance. We must
		make sure, the server is mapping us the XML correctly with 'id' attribute
		and not 'id' as element.
	</p><p>
		This is the moment we go back to the server and start output form validation.
		We add a <code class="filename">CustomerList.simpleform</code> form which describes
		the result of the 'CustomerListRequest' more precisely and especially
		declares the 'id' as mandatory attribute of the customer:
	</p><pre class="programlisting">
	FORM CustomerList
	{
		list
		{
			customer []
			{
				id !@string
				name string
				address string
			}
		}
	}

	</pre><p>
		We have to declare output form validation in the 'CustomerListRequest'
		in <code class="filename">tutorial.directmap</code> as well:

	</p><pre class="programlisting">
	CustomerListRequest = SelectCustomerList( xml ) : CustomerList;
	</pre><p>
	
		and we have to include the program in <code class="filename">tutorial.conf</code> of the server:

	</p><pre class="programlisting">
	Processor {
		..
		program CustomerList.simpleform	
		..
	}
	</pre><p>
	
		Checking with:

	</p><pre class="programlisting">
	netcat -v --wait=2 localhost 7661 &lt; CustomerListRequest.netcat
	</pre><p>
	
		we get now:

	</p><pre class="programlisting">
	&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
	&lt;!DOCTYPE list SYSTEM "CustomerList.simpleform"&gt;
	&lt;list&gt;
	  &lt;customer id="1"&gt;
	    &lt;name&gt;Dr Who&lt;/name&gt;
	    &lt;address&gt;Blue Police Box&lt;/address&gt;
	  &lt;/customer&gt;
	  &lt;customer id="2"&gt;
	    &lt;name&gt;John Smith&lt;/name&gt;
	    &lt;address&gt;The Wheel in Space&lt;/address&gt;
	  &lt;/customer&gt;
	&lt;/list&gt;

	</pre><p>

		So, that looks ok.
	</p><p>
		Now also the qtlient shows the id of the customer, when the user double
		clicks the customer in the list.
	</p><p>
		The 'name' and the 'address' fields are still empty. We could of course
		use global variables again to propagate the values between forms, but
		if the form gets more complex, this is not a good idea.
	</p><p>
		We start to use the 'initAction' property on the <code class="filename">customer_show.ui</code> form
		as follows: we want it to execute a read with a document type 'CustomerRequest'
		which searches for a single customer by customer id:
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customer_show_initaction.png" /></div></div><p>
		We see, that we use the value of 'global.id' again and add it to the 'initAction'
		request as attribute 'id' (we can use the wolfclient with -d to see the communication
		on the wire):

	</p><pre class="programlisting">
	&lt;?xml version="1.0" encoding="UTF-8"?&gt;
	&lt;!DOCTYPE customer SYSTEM 'CustomerRequest'&gt;
	&lt;customer id="2"/&gt;

	</pre><p>

		We also get in the client:

	</p><pre class="programlisting">
	CRITICAL: ERROR: error in network data loader "Protocol error in command REQUEST, received:  no command handler for 'CustomerRequest'." 
	</pre><p>

		and in the server:

	</p><pre class="programlisting">
	ERROR: error redirect input: no command handler for 'CustomerRequest'
	</pre><p>

	We see, that the request is sent to the server, but we didn't define the
	necessary things in the server yet. So we add another map:

	</p><pre class="programlisting">
	CustomerRequest = SelectCustomer( xml ) : Customer;
	</pre><p>

		to <code class="filename">tutorial.directmap</code>.
	</p><p>
		We define a new file <code class="filename">CustomerRequest.simpleform</code> which contains the
		validation of the customer request (for now, this looks exactly like
		the request for the list of customers, but we may want to change that
		later):
	</p><pre class="programlisting">
	FORM CustomerRequest
	{
		customer {
			id ?@string
		}
	}

	</pre><p>
	We register the form in <code class="filename">tutorial.conf</code>:

	</p><pre class="programlisting">
	Processor {
		..
		program CustomerRequest.simpleform
		..
	}
	</pre><p>
	
		And of course we have to define a transaction function 'SelectCustomer'
		in <code class="filename">Customer.tdl</code>:

	</p><pre class="programlisting">
	TRANSACTION SelectCustomer
	RESULT INTO customer
	BEGIN
		INTO . DO SELECT * from Customer WHERE id=$(customer/id);
	END
	</pre><p>
	
		The '$(customer/id)' refers to the ID we pass down for the customer record
		to retrieve. The 'RESULT INTO customer' makes sure the result will again
		be in a table with 'customer' as root element.
	</p><p>	
		We also have to define how the result should be mapped, so:

	</p><pre class="programlisting">
	Processor {
		..
		program Customer.simpleform
		..
	}
	</pre><p>
	
		and <code class="filename">Customer.simpleform</code>:

	</p><pre class="programlisting">
	FORM Customer
	{
		customer
		{
			id !@string
			name string
			address string
		}
	}

	</pre><p>

		Now if we restart client and server and we click on the second
		customer in the list we get:
	</p><div class="screenshot"><div class="mediaobject"><img src="images/Tutorial/step6_customer_show_working.png" /></div></div><p>
		So we successfully read the data of a customer into a form.
	</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk01ch02s05.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk01ch02.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk01ch02s07.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.5. Step 5 - Implement client side customer list </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2.7. Step 7 - Editing customer</td></tr></table></div></div></div>

<!-- Footer -->
<div xmlns="" class="wrapper row2">
	<div id="footer" class="clear">
		<div class="one_third first">
			<h2 class="footer_title">Documentation</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/documentation.html">User documentation</a></li>
					<li><a href="/documentation.html">Developer documentation</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Downloads</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/downloads.html">Hosted on Github</a></li>
					<li><a href="/downloads.html">Packages on Sourceforge</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Contact Us</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><strong>Email:</strong> <a href="/mailto:contact@wolframe.net">contact@wolframe.net</a></li>
					<li>
						<a id="googleplus-bttn" href="http://plus.google.com/116915890857205562872?prsrc=3" rel="publisher" target="_top" style="text-decoration:none;">
							<span>Google+</span></a>
						<a id="linkedin-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>LinkedIn</span></a>
						<a id="twitter-bttn" href="http://twitter.com/ProjectWolframe" target="_top" style="text-decoration:none;">
							<span>twitter</span></a>
						<a id="rss-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>rss</span></a>
					</li>
					<li>
						<a href="https://twitter.com/ProjectWolframe" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @ProjectWolframe</a>
						<div class="google-follow-button"><div class="g-follow" data-annotation="none" data-height="20" data-href="http://plus.google.com/116915890857205562872" data-rel="publisher"></div></div>
						<div class="google-plusone-button"><div class="g-plusone" data-href="http://www.wolframe.net" data-size="medium"></div></div>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>

<div xmlns="" class="wrapper row4">
	<div id="copyright" class="clear">
		<p class="fl_left">Copyright © 2013 - <a href="#">Project Wolframe</a> - All Rights Reserved</p>
		<p class="fl_right"><a href="/copyright.html">Copyrights and credits</a></p>
	</div>
</div>

<!-- Scripts -->
<script xmlns="" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script xmlns="" src="http://code.jquery.com/ui/1.10.1/jquery-ui.min.js"></script>
<script xmlns="">window.jQuery || document.write('\x3Cscript src="/layout/scripts/jquery-latest.min.js"&gt;\x3C\/script&gt;\
\x3Cscript src="/layout/scripts/jquery-ui.min.js"&gt;\x3C\/script&gt;')</script>
<script xmlns="">jQuery(document).ready(function($){ $('img').removeAttr('width height'); });</script>
<script xmlns="" src="/layout/scripts/jquery-mobilemenu.min.js"></script>
<script xmlns="" src="/layout/scripts/custom.js"></script>

<!-- Tweeter follow script -->
<script xmlns="">
	!function( d, s, id )	{
		var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location)?'http':'https';
		if( !d.getElementById( id ))	{
			js = d.createElement( s );
			js.id = id;
			js.src = p + '://platform.twitter.com/widgets.js';
			fjs.parentNode.insertBefore( js,fjs );
		}
	} ( document, 'script', 'twitter-wjs' );
</script>

<!-- Google +1, follow -->
<script xmlns="" type="text/javascript">
	window.___gcfg = {
		lang: 'en-US',
		parsetags: 'onload'
	};
	( function()	{
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	}) ();
</script>

</body></html>