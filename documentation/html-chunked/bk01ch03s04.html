<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3.4. Functions in Lua</title><link rel="stylesheet" type="text/css" href="/layout/styles/main.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Wolframe documentation" /><link rel="up" href="bk01ch03.html" title="Chapter 3. Functions" /><link rel="prev" href="bk01ch03s03.html" title="3.3. Functions in Python" /><link rel="next" href="bk01ch03s05.html" title="3.5. DDL Data Types" />
	<title xmlns="">Project Wolframe</title>
	<meta xmlns="" charset="iso-8859-1" />
	<meta xmlns="" name="viewport" content="width=device-width, initial-scale=1.0" />

	<link xmlns="" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

	<link xmlns="" href="/layout/styles/main.css" rel="stylesheet" type="text/css" media="all" />
	<link xmlns="" href="/layout/styles/mediaqueries.css" rel="stylesheet" type="text/css" media="all" />

	<!--[if lt IE 9]>
		<link href="/layout/styles/ie/ie8.css" rel="stylesheet" type="text/css" media="all">
		<script src="/layout/scripts/ie/css3-mediaqueries.min.js"></script>
		<script src="/layout/scripts/ie/html5shiv.min.js"></script>
	<![endif]-->
	
</head><body>

<div xmlns="" class="wrapper row1">
	<header id="header" class="full_width clear">
		<hgroup>
			<h1><a href="/index.html">Project Wolframe</a></h1>
			<h2>Free Responsive Template</h2>
		</hgroup>
		<div id="header-contact">
			<ul class="list none">
				<li><span class="icon-envelope"></span> <a href="mailto:contact@wolframe.net">contact@wolframe.net</a></li>
<!--				<li><span class="icon-phone"></span> +xx xxx xxxxxxxxxx</li> -->
			</ul>
		</div>
	</header>
</div>

<!-- ################################################################################################ -->
<div xmlns="" class="wrapper row2">
	<nav id="topnav">
		<ul class="clear">
			<li><a href="/index.html" title="Home">Home</a></li>
			<li><a href="/solutions.html" title="Solutions">Solutions</a></li>
			<li><a href="/downloads.html" title="Downloads">Downloads</a></li>
			<li class="active"><a href="/documentation.html" title="Documentation">Documentation</a></li>
			<li><a class="drop" title="Support">Support</a>
				<ul>
					<li><a href="/404.html" title="404 page">404</a></li>
					<li><a href="/faq.html" title="FAQ">FAQ</a></li>
					<li class="last-child"><a href="http://www.google.com/?query=free%20mailing%20lists" title="Mailing lists">Mailing lists</a></li>
				</ul>
			</li>
			<li class="last-child"><a href="/contact.html" title="Contact Us">Contact Us</a></li>
		</ul>
	</nav>
</div>
<!-- ################################################################################################ -->

<div class="wrapper row3"><div id="container"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.4. Functions in Lua</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk01ch03s03.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Functions</th><td width="20%" align="right"> <a accesskey="n" href="bk01ch03s05.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1383055108"></a>3.4. Functions in Lua</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383029372"></a>3.4.1. Introduction</h3></div></div></div><p>You can write functions for the logic tier of <span class="application">Wolframe</span> with <span class="application">Lua</span>. <span class="application">Lua</span> is a scripting language designed, implemented, and maintained
		at PUC-Rio in Brazil by Roberto Ierusalimschy, Waldemar Celes and Luiz Henrique de Figueiredo
		(see <a class="ulink" href="http://www.lua.org/authors.html" target="_top">http://www.lua.org/authors.html</a>). A description of <span class="application">Lua</span> is not provided here.
		For an introduction into programming with <span class="application">Lua</span> see <a class="ulink" href="http://www.lua.org" target="_top">http://www.lua.org</a>. The official manual which is also available as book
		is very good. <span class="application">Wolframe</span> introduces some <span class="application">Lua</span> interfaces to access input and output and to execute functions.
		The <span class="application">Lua</span> application layer does not have to deal with protocol or encryption issues.
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383082908"></a>3.4.2. Declaring Functions</h3></div></div></div><p>For <span class="application">Lua</span> you do not have to declare anything in addition to the <span class="application">Lua</span> script. If you configure a <span class="application">Lua</span>
		script as program, all global functions declared in this script are declared as form
		functions in <span class="application">Wolframe</span>. For avoiding name conflicts you should declare private functions
		of the script as <code class="code">local</code>.
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383085196"></a>3.4.3. Wolframe Provider Library</h3></div></div></div><p><span class="application">Wolframe</span> lets you access objects of the global context through
		a library called <code class="code">provider</code> offering the following functions:

		</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Name</td><td>Parameter</td><td>Returns</td></tr><tr><td>form</td><td>name of the form</td><td>an instance of a form</td></tr><tr><td>normalizer</td><td>name of the normalize function</td><td>normalize function defined in a <span class="application">Wolframe</span> normalizer program</td></tr><tr><td>formfunction</td><td>name of the function</td><td>form function defined in a <span class="application">Wolframe</span> program or module</td></tr></table><p>
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383089180"></a>3.4.4. Wolframe Global Objects</h3></div></div></div><p>Besides the provider library <span class="application">Wolframe</span> defines the following objects global in the script execution context:
		</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Name</td><td>Description</td></tr><tr><td>transaction</td><td>transaction context if not relying on the auto-commit of a transaction function</td></tr><tr><td>scope</td><td>function with an iterator as argument returning an iterator for iterating on the currently visited node and its children taking ownership on this sub iterator scope</td></tr><tr><td>logger</td><td>object with methods for logging or debugging</td></tr></table><p>
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383092220"></a>3.4.5. Using Forms</h3></div></div></div><p>The provider function <code class="code">provider.form( )</code> with the name of the form as string as parameter returns an empty
		instance of a form. It takes the name of the form as string argument.
		If you for example have a form configured called "employee" and you want to create an
		employee object from a <span class="application">Lua</span> table, you call
			</p><pre class="programlisting">
			
bcf = provider.form( "employee" )
bcf:fill( {surname='Hans', name='Muster', company='Wolframe'} )

			</pre><p>
		The first line creates the data form object.
		The second line fills the data into the data form object.
		</p><p>

		The form method <code class="code">fill</code> takes a second optional parameter. Passing "strict" as
		second parameter enforces a strict validation of the input against the form, meaning that
		attributes are checked to be attributes (when using XML serialization) and non optional elements are checked to be initialized.
		Passing "complete" as second parameter forces non optional elements to be checked for initialization
		but does not distinguish between attributes and content values. "relaxed" is the default and
		checks only the existence of filled-in values in the form.
		</p><p>
		Given the following validation form:
			</p><pre class="programlisting">
			
FORM Employee
{
   employee
   {
       ID !@int                  ; Internal customer id (mandatory)
       name !string              ; Name of the customer (mandatory)
       company string            ; Company he is working for (optional)
   }
}

			</pre><p>

		the call of <code class="code">fill</code> in the following piece of code will raise an error because some elements
		of the form ('ID' and 'name') are missing in the input:
			</p><pre class="programlisting">
			
bc = provider.form( "employee" ):fill( {company='Wolframe'}, "strict" )

			</pre><p>
		</p><p>
		To access the data in a form there are two form methods available. <code class="code">get()</code> returns an iterator on the form data similar
		to the iterator on input. Same as for input there is a method <code class="code">value()</code> that returns the form data as <span class="application">Lua</span> data structure
		(a <span class="application">Lua</span> table or atomic value).
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383099340"></a>3.4.6. Form Functions</h3></div></div></div><p>
		For calling transactions or built-in functions loaded as modules the <span class="application">Lua</span> layer defines the
		concept of functions. The provider function <code class="code">provider.formfunction</code> with the name of the function
		as argument returns a <span class="application">Lua</span> function. This function takes a table or an iterator as argument
		and returns a data form structure. The data in the returned form data structure can be
		accessed with <code class="code">get()</code> that returns an iterator on the content and <code class="code">value()</code>
		that returns a <span class="application">Lua</span> table or atomic value.
		</p><p>
		If you for example have a transaction called "insertEmployee" defined in a transaction description program
		file declared in the configuration called "insertEmployee" and you want to call it with the 'employee'
		object defined above as input, you do
			</p><pre class="programlisting">
			
f = provider.formfunction( "insertEmployee")
res = f ( {surname='Hans', name='Muster', company='Wolframe'} )
t = res:value()
output:print( t[ "id" ] )

			</pre><p>
		</p><p>
		The first line creates the function called "insertEmployee" as <span class="application">Lua</span> function.
		The second calls the transaction, the third creates a <span class="application">Lua</span> table out of the result
		and the fourth selects and prints the "id" element in the table.
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1383104340"></a>3.4.7. List of <span class="application">Lua</span> Objects</h3></div></div></div><p>This is a list of all objects and functions declared by Wolframe:</p><div class="table"><a id="idp1383105236"></a><p class="title"><strong>Table 3.1. Data forms declared by DDL</strong></p><div class="table-contents"><table summary="Data forms declared by DDL" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Method Name</th><th>Arguments</th><th>Returns</th><th>Description</th></tr></thead><tbody><tr><td>get</td><td> </td><td>iterator (*)</td><td>Returns an iterator on the form elements</td></tr><tr><td>value</td><td> </td><td><span class="application">Lua</span> table</td><td>Returns the contents of the data form as <span class="application">Lua</span> table or atomic value</td></tr><tr><td>__tostring</td><td> </td><td>string</td><td>String representation of form for debugging</td></tr><tr><td>name</td><td> </td><td>string</td><td>Returns the global name of the form.
					</td></tr><tr><td>fill</td><td><span class="application">Lua</span> table or iterator (*), optional validation mode (**)</td><td>the filled form (for concatenation)</td><td>Validates input and fills the input data into the form.</td></tr></tbody></table></div></div><br class="table-break" /><p>
			(*) With iterator we mean an iterator as introduced in previous sections, returned by a Wolframe <span class="application">Lua</span> object 'get()' method.
		</p><p>
			(**) "strict" (full validation), "complete" (only check for all non optional elements initialization) or "relaxed" (no validation except matching of input to elements)
		</p><div class="table"><a id="idp1383114172"></a><p class="title"><strong>Table 3.2. Data forms returned by functions</strong></p><div class="table-contents"><table summary="Data forms returned by functions" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Method Name</th><th>Returns</th><th>Description</th></tr></thead><tbody><tr><td>get</td><td>iterator (*)</td><td>Returns an iterator on the form elements</td></tr><tr><td>value</td><td><span class="application">Lua</span> table or atomic value</td><td>Returns the contents of the data form as <span class="application">Lua</span> table or atomic value</td></tr><tr><td>__tostring</td><td>string</td><td>String representation of form for debugging</td></tr></tbody></table></div></div><br class="table-break" /><p>
			(*) With iterator we mean an iterator as introduced in previous sections, returned by a Wolframe <span class="application">Lua</span> object 'get()' method.
		</p><div class="table"><a id="idp1383119924"></a><p class="title"><strong>Table 3.3. Global Transaction Context</strong></p><div class="table-contents"><table summary="Global Transaction Context" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Method Name</th><th>Description</th></tr></thead><tbody><tr><td>transaction.begin</td><td>Starts a transaction</td></tr><tr><td>transaction.commit</td><td>Commit of a transaction</td></tr><tr><td>transaction.rollback</td><td>Rollback of a transaction</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp1383123548"></a><p class="title"><strong>Table 3.4. Logger functions</strong></p><div class="table-contents"><table summary="Logger functions" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Method Name</th><th>Arguments</th><th>Description</th></tr></thead><tbody><tr><td>logger.printc</td><td>arbitrary list of arguments</td><td>Print arguments to standard console output</td></tr><tr><td>logger.print</td><td>loglevel (string) plus arbitrary list of arguments</td><td>log argument list with defined log level</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp1383127324"></a><p class="title"><strong>Table 3.5. Global functions</strong></p><div class="table-contents"><table summary="Global functions" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Function Name</th><th>Arguments</th><th>Description</th></tr></thead><tbody><tr><td>provider.form</td><td>name of form (string)</td><td>Returns an empty data form object of the given type</td></tr><tr><td>provider.formfunction</td><td>name of function (string)</td><td>Returns a lua function to execute the <span class="application">Wolframe</span> function specified by name</td></tr><tr><td>provider.normalizer</td><td>type name</td><td>Returns a <span class="application">Lua</span> function for normalizing values of the type specified (as used in forms)</td></tr><tr><td>scope</td><td>iterator (*)</td><td>Returns an iterator to iterate till the end of the current tag (**)</td></tr></tbody></table></div></div><br class="table-break" /><p>
			(*) With iterator we mean an iterator as introduced in previous sections, returned by a <span class="application">Wolframe</span> <span class="application">Lua</span> object 'get()' method.
		</p><p>
			(**) The iterator of a defined scope must be consumed completely before consuming anything of the parent iterator.
			Otherwise it may lead to unexpected results because they share some part of the iterator state.
		</p></div><p></p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk01ch03s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk01ch03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk01ch03s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.3. Functions in Python </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3.5. DDL Data Types</td></tr></table></div></div></div>
	
<!-- Footer -->
<div xmlns="" class="wrapper row2">
	<div id="footer" class="clear">
		<div class="one_quarter first">
			<h2 class="footer_title">Solutions</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="#">Simple CRM</a></li>
					<li><a href="#">Bug reporting tool</a></li>
					<li><a href="#">Message broker</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Documentation</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/documentation.html">User documentation</a></li>
					<li><a href="/documentation.html">Developer documentation</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Downloads</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/downloads_wolframe.html">Wolframe server</a></li>
					<li><a href="/downloads_wolfclient.html">Wolframe client</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Contact Us</h2>
			<p><strong>Email:</strong> <a href="mailto:contact@wolframe.net">contact@wolframe.net</a></p>
		</div>
  </div>
</div>

<div xmlns="" class="wrapper row4">
	<div id="copyright" class="clear">
		<p class="fl_left">Copyright © 2013 - <a href="#">Project Wolframe</a> - All Rights Reserved</p>
		<p class="fl_right">Template by <a href="http://www.os-templates.com/" title="Free Website Templates">OS Templates</a></p>
	</div>
</div>

<!-- Scripts -->
<script xmlns="" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script xmlns="" src="http://code.jquery.com/ui/1.10.1/jquery-ui.min.js"></script>
<script xmlns="" src="/layout/scripts/jquery-mobilemenu.min.js"></script>
<script xmlns="" src="/layout/scripts/custom.js"></script>

</body></html>