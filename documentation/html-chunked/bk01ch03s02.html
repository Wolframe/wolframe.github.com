<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3.2. Functions in .NET</title><link rel="stylesheet" type="text/css" href="/layout/styles/main.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Wolframe documentation" /><link rel="up" href="bk01ch03.html" title="Chapter 3. Functions" /><link rel="prev" href="bk01ch03.html" title="Chapter 3. Functions" /><link rel="next" href="bk01ch03s03.html" title="3.3. Functions in Python" />
	<title xmlns="">Project Wolframe</title>
	<meta xmlns="" charset="utf-8" />
	<meta xmlns="" name="viewport" content="width=device-width, initial-scale=1.0" />

	<link xmlns="" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

	<link xmlns="" href="/layout/styles/main.css" rel="stylesheet" type="text/css" media="all" />
	<link xmlns="" href="/layout/styles/mediaqueries.css" rel="stylesheet" type="text/css" media="all" />

	<!--[if lt IE 9]>
		<link href="/layout/styles/ie/ie8.css" rel="stylesheet" type="text/css" media="all" />
		<script src="/layout/scripts/ie/css3-mediaqueries.min.js"></script>
		<script src="/layout/scripts/ie/html5shiv.min.js"></script>
	<![endif]-->


</head><body>


<div xmlns="" class="wrapper row1">
	<header id="header" class="full_width clear">
		<div id="header-logo">
			<h1><a href="/index.html">Project Wolframe</a></h1>
			<h2>The Straight Path to Successful Projects</h2>
		</div>
		<div id="header-search">
			<form id="cse-search-box" action="http://www.wolframe.net/gsearch.html">
				<input type="hidden" name="cx" value="007231504736047898702:wrnjvfljzvu" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
<!--				<input type="submit" name="sa" value="&#xf002;" /> -->
				<input type="submit" name="sa" class="search-bttn" value="" />
			</form>
		</div>
	</header>
</div>

<!-- ################################################################################################ -->
<div xmlns="" class="wrapper row2">
	<nav id="topnav">
		<ul class="clear">
<!-- BEGIN MENU -->
			<li><a href="/index.html" title="Home">Home</a></li>
			<li><a href="/downloads.html" title="Downloads">Downloads</a></li>
			<li class="active"><a href="/documentation.html" title="Documentation">Documentation</a></li>
			<li><a class="drop" href="/support.html" title="Support">Support</a>
				<ul>
					<li><a href="/faqs.html" title="FAQ">FAQ</a></li>
					<li><a href="http://sourceforge.net/p/wolframe/mailman/" title="Mailing lists">Mailing lists</a></li>
				</ul>
			</li>
			<li class="last-child"><a href="/contact.html" title="Contact Us">Contact Us</a></li>
<!-- END MENU -->
		</ul>
	</nav>
</div>

<!-- ################################################################################################ -->
<div class="wrapper row3"><div id="container"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.2. Functions in .NET</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk01ch03.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Functions</th><td width="20%" align="right"> <a accesskey="n" href="bk01ch03s03.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1392930780"></a>3.2. Functions in .NET</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392931100"></a>3.2.1. Introduction</h3></div></div></div><p>You can write functions for the logic tier of <span class="application">Wolframe</span> in languages based
		on <span class="application">.NET</span> (<a class="ulink" href="http://www.microsoft.com/net" target="_top">http://www.microsoft.com/net</a>) like for example
		<span class="application">C#</span> and <span class="application">VB.NET</span>.  
		Because <span class="application">.NET</span> based libraries can only be called 
		by <span class="application">Wolframe</span> only as a 
		compiled and not as an interpreted language, you have to build a module out of your function 
		implementation.
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392964004"></a>3.2.2. Configuration</h3></div></div></div><p>For enabling .NET you have to declare the loading of the module 'mod_command_dotnet'
		in the main section of the server configuration file.
		</p><pre class="programlisting">
		
    module mod_command_dotnet

		</pre><p>
		For the configuration of the .NET assemblies to be loaded, see section 'Configure .NET Modules'.
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392965724"></a>3.2.3. Restrictions</h3></div></div></div><p>
		Currently <span class="application">.NET</span> procedures called from Wolframe
		cannot call other Wolframe functions.
		But we will provide the possibility to call Wolframe global function calls
		like for example transaction function calls from <span class="application">.NET</span>
		soon.
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392967132"></a>3.2.4. Prepare .NET Modules</h3></div></div></div><p>
	To make functions written in .NET callable by Wolframe, several steps have to be performed.
	First the asseblies with the functions exported to Wolframe have to be build COM visible.
	Wolframe itself is not a .NET application. Therefore it has to call .NET functions via
	COM/.NET interop interface of the CLR.
	</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392967964"></a>Make Assemblies COM visible</h4></div></div></div><p>To make the .NET functions called from Wolframe COM visible, you have to tick
		"Properties/Assembly Information" the switch "Make assembly COM visible". Furthermore
		every object and method that is part of the exported API (also objects used as parameters)
		has to be tagged in the source as COM visible with <code class="code">[ComVisible(true)]</code>.
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392969052"></a>Tag Exported Objects with a Guid</h4></div></div></div><p>Each object that is part of the exported API has to be tagged with a global unique
		identifier (Guid) in order to be adressable. Modules with .NET functions will have to be globally
		registered and the objects need to be identified by the Guid because that's the only way
		to make the record info structure visible for Wolframe. The record info structure is
		needed to serialize/deserialize .NET objects from another interpreter context that
		is not registered for .NET. There are many ways to create a Guid and
		tag an object like this: <code class="code">[Guid("390E047F-36FD-4F23-8CE8-3A4C24B33AD3")]</code>.
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392970468"></a>Add Marshalling Tags to Values</h4></div></div></div><p>For marshalling function calls correctly, Wolframe needs
		tags for every parameter and member of a sub structure of a parameter
		of methods exported as functions.
		The following table lists the supported types and their marshalling tags:
		</p><div class="table"><a id="idp1392971268"></a><p class="title"><strong>Table 3.1. Marshalling Tags</strong></p><div class="table-contents"><table summary="Marshalling Tags" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>.NET Type</th><th>Marshalling Tag</th></tr></thead><tbody><tr><td>I2</td><td><code class="code">[MarshalAs(UnmanagedType.I2)]</code></td></tr><tr><td>I4</td><td><code class="code">[MarshalAs(UnmanagedType.I4)]</code></td></tr><tr><td>I8</td><td><code class="code">[MarshalAs(UnmanagedType.I8)]</code></td></tr><tr><td>UI2</td><td><code class="code">[MarshalAs(UnmanagedType.UI2)]</code></td></tr><tr><td>UI4</td><td><code class="code">[MarshalAs(UnmanagedType.UI4)]</code></td></tr><tr><td>UI8</td><td><code class="code">[MarshalAs(UnmanagedType.UI8)]</code></td></tr><tr><td>R4</td><td><code class="code">[MarshalAs(UnmanagedType.R4)]</code></td></tr><tr><td>R8</td><td><code class="code">[MarshalAs(UnmanagedType.R8)]</code></td></tr><tr><td>BOOL</td><td><code class="code">[MarshalAs(UnmanagedType.BOOL)]</code></td></tr><tr><td>string</td><td><code class="code">[MarshalAs(UnmanagedType.BStr)]</code></td></tr><tr><td>RECORD</td><td><p>no tag needed</p></td></tr><tr><td>array of structures</td><td><code class="code">[MarshalAs(UnmanagedType.SafeArray, SafeArraySubType = VarEnum.VT_RECORD)]</code></td></tr><tr><td>array of strings</td><td><code class="code">[MarshalAs(UnmanagedType.SafeArray, SafeArraySubType = VarEnum.VT_BSTR)]</code></td></tr><tr><td>array of XX (XX=I2,I4,I8,..)</td><td><code class="code">[MarshalAs(UnmanagedType.SafeArray, SafeArraySubType = VarEnum.VT_XX)]</code></td></tr></tbody></table></div></div><br class="table-break" /><p>Decimal floating point and numeric types (DECIMAL) are not yet supported, but
		will soon be available.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392983908"></a>Create a Type Library</h4></div></div></div><p>For making the API introspectable by Wolframe, we have to create a TLB
		(Type Library) file from the assembly (DLL) after build. The type library has
		to be recreated every time the module interface (API) changes. The type library is
		created with the program <code class="code">tlbexp</code>. All created type library (.tlb) file
		that will be loaded with the same runtime environment have to be copied into
		the same directory. They will be referenced for introspection in the 
		configuration. The configuration of .NET will be explained later.
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392985220"></a>Register the Type Library</h4></div></div></div><p>The type library created with <code class="code">tlbexp</code> has also to be registered.
		For this you call the program <code class="code">regtlibv12</code> with your type library file
		(.tlb file) as argument. The type libary fegistration has to be repeated when
		the the module interface (API) changes.
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1392986452"></a>Register the Assembly in the GAC</h4></div></div></div><p>Wolframe does not accept local assemblies. In order to be addressable over
		the type library interface assemblies need to be put into the global assembly cache (GAC).
		Unfortunately this has to be repeated every time the assembly binary changes.
		There is no way around. For registration in the GAC you have to call the program
		<code class="code">gacutil /if &lt;assemblypath&gt;</code> with your assembly path &lt;assemblypath&gt;
		as argument. Furthermore the command <code class="code">gacutil</code> has to be called from
		administrator command line.
		</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392988116"></a>3.2.5. Configure .NET Modules</h3></div></div></div><p>
	.NET modules are grouped together in a configuration block that specifies the configuration
	of the Microsoft Common Language Runtime (CLR) used for .NET interop calls. The configuration
	block has the header <code class="code">runtimeEnv dotNET</code> and configures the version of the 
	runtime loaded and the path where the typelibraries (.tlb) files can be found. 
	With the <code class="code">assembly</code> definitions you declare the registered assemblies to load.
	</p><pre class="programlisting">
	
runtimeenv dotnet
{
    clrversion   "v4.0.30319"
    typelibpath  programs/typelibrary
    assembly     "Functions, Version=1.0.0.30, Culture=neutral, PublicKeyToken=1c1d731dc6e1cbe1, processorArchitecture=MSIL"
    assembly     "Utilities, Version=1.0.0.27, Culture=neutral, PublicKeyToken=1c1f723cc51212ef, processorArchitecture=MSIL"
}

	</pre><p>
	</p></div><p></p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk01ch03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk01ch03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk01ch03s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. Functions </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3.3. Functions in Python</td></tr></table></div></div></div>

<!-- Footer -->
<div xmlns="" class="wrapper row2">
	<div id="footer" class="clear">
		<div class="one_third first">
			<h2 class="footer_title">Documentation</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/documentation.html">User documentation</a></li>
					<li><a href="/documentation.html">Developer documentation</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Downloads</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/downloads.html">Hosted on Github</a></li>
					<li><a href="/downloads.html">Packages on Sourceforge</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Contact Us</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><strong>Email:</strong> <a href="/mailto:contact@wolframe.net">contact@wolframe.net</a></li>
					<li>
						<a id="googleplus-bttn" href="http://plus.google.com/116915890857205562872?prsrc=3" rel="publisher" target="_top" style="text-decoration:none;">
							<span>Google+</span></a>
						<a id="linkedin-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>LinkedIn</span></a>
						<a id="twitter-bttn" href="http://twitter.com/ProjectWolframe" target="_top" style="text-decoration:none;">
							<span>twitter</span></a>
						<a id="rss-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>rss</span></a>
					</li>
					<li>
						<a href="https://twitter.com/ProjectWolframe" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @ProjectWolframe</a>
						<div class="google-follow-button"><div class="g-follow" data-annotation="none" data-height="20" data-href="http://plus.google.com/116915890857205562872" data-rel="publisher"></div></div>
						<div class="google-plusone-button"><div class="g-plusone" data-href="http://www.wolframe.net" data-size="medium"></div></div>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>

<div xmlns="" class="wrapper row4">
	<div id="copyright" class="clear">
		<p class="fl_left">Copyright © 2013 - <a href="#">Project Wolframe</a> - All Rights Reserved</p>
		<p class="fl_right"><a href="/copyright.html">Copyrights and credits</a></p>
	</div>
</div>

<!-- Scripts -->
<script xmlns="" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script xmlns="" src="http://code.jquery.com/ui/1.10.1/jquery-ui.min.js"></script>
<script xmlns="">window.jQuery || document.write('\x3Cscript src="/layout/scripts/jquery-latest.min.js"&gt;\x3C\/script&gt;\
\x3Cscript src="/layout/scripts/jquery-ui.min.js"&gt;\x3C\/script&gt;')</script>
<script xmlns="">jQuery(document).ready(function($){ $('img').removeAttr('width height'); });</script>
<script xmlns="" src="/layout/scripts/jquery-mobilemenu.min.js"></script>
<script xmlns="" src="/layout/scripts/custom.js"></script>

<!-- Google analytics tracking -->
<script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46433226-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- Tweeter follow script -->
<script xmlns="">
	!function( d, s, id )	{
		var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location)?'http':'https';
		if( !d.getElementById( id ))	{
			js = d.createElement( s );
			js.id = id;
			js.src = p + '://platform.twitter.com/widgets.js';
			fjs.parentNode.insertBefore( js,fjs );
		}
	} ( document, 'script', 'twitter-wjs' );
</script>

<!-- Google +1, follow -->
<script xmlns="" type="text/javascript">
	window.___gcfg = {
		lang: 'en-US',
		parsetags: 'onload'
	};
	( function()	{
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	}) ();
</script>

</body></html>