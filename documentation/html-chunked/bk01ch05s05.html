<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.5. Forms</title><link rel="stylesheet" type="text/css" href="/layout/styles/main.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Wolframe documentation" /><link rel="up" href="bk01ch05.html" title="Chapter 5. Data processing" /><link rel="prev" href="bk01ch05s04.html" title="5.4. Functions" /><link rel="next" href="bk01ch05s06.html" title="5.6. Filters" />
	<title xmlns="">Project Wolframe</title>
	<meta xmlns="" charset="utf-8" />
	<meta xmlns="" name="viewport" content="width=device-width, initial-scale=1.0" />

	<link xmlns="" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

	<link xmlns="" href="/layout/styles/main.css" rel="stylesheet" type="text/css" media="all" />
	<link xmlns="" href="/layout/styles/mediaqueries.css" rel="stylesheet" type="text/css" media="all" />

	<!--[if lt IE 9]>
		<link href="/layout/styles/ie/ie8.css" rel="stylesheet" type="text/css" media="all" />
		<script src="/layout/scripts/ie/css3-mediaqueries.min.js"></script>
		<script src="/layout/scripts/ie/html5shiv.min.js"></script>
	<![endif]-->


</head><body>


<div xmlns="" class="wrapper row1">
	<header id="header" class="full_width clear">
		<div id="header-logo">
			<h1><a href="/index.html">Project Wolframe</a></h1>
			<h2>The Straight Path to Successful Projects</h2>
		</div>
		<div id="header-search">
			<form id="cse-search-box" action="http://www.wolframe.net/gsearch.html">
				<input type="hidden" name="cx" value="007231504736047898702:wrnjvfljzvu" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
<!--				<input type="submit" name="sa" value="&#xf002;" /> -->
				<input type="submit" name="sa" class="search-bttn" value="" />
			</form>
		</div>
	</header>
</div>

<!-- ################################################################################################ -->
<div xmlns="" class="wrapper row2">
	<nav id="topnav">
		<ul class="clear">
<!-- BEGIN MENU -->
			<li><a href="/index.html" title="Home">Home</a></li>
			<li><a href="/downloads.html" title="Downloads">Downloads</a></li>
			<li class="active"><a href="/documentation.html" title="Documentation">Documentation</a></li>
			<li><a class="drop" href="/support.html" title="Support">Support</a>
				<ul>
					<li><a href="/faqs.html" title="FAQ">FAQ</a></li>
					<li><a href="http://sourceforge.net/p/wolframe/mailman/" title="Mailing lists">Mailing lists</a></li>
				</ul>
			</li>
			<li class="last-child"><a href="/contact.html" title="Contact Us">Contact Us</a></li>
<!-- END MENU -->
		</ul>
	</nav>
</div>

<!-- ################################################################################################ -->
<div class="wrapper row3"><div id="container"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.5. Forms</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk01ch05s04.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Data processing</th><td width="20%" align="right"> <a accesskey="n" href="bk01ch05s06.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1377499916"></a>5.5. Forms</h2></div></div></div><p>
Forms are data structures used to validate input and output data and to do some basic normalization
in order to make data accessible in a uniform way. Forms are defined in a data definition language
(<acronym class="acronym">DDL</acronym>) and translated by a compiler at startup. Those compilers are defined as loadable
modules.
</p><p>
This chapter describes how form data schemas are linked to the logic tier. It introduces a data description
language (<acronym class="acronym">DDL</acronym>) called <code class="code">simpleform</code> that allows you to specify data schemas with the validation and 
normalization of atomic types. It also describes the <span class="application">Wolframe</span> module concept for form descriptions that 
allows you to add a compiler for your existing data schemas.
</p><p>
After reading this chapter you should be able to write data forms of <span class="application">Wolframe</span> of the  logic tier 
in the <code class="code">simpleform</code> data description language on your own. You should also know how a new data description
language (<acronym class="acronym">DDL</acronym>) could be added.
</p><p>
Be aware that you have to configure a data description language type (<acronym class="acronym">DDL</acronym> compiler) of the logic tier 
in <span class="application">Wolframe</span> before using it. Each chapter introducing a data form description language will have 
a section that describes how the server configuration of <span class="application">Wolframe</span> has to be extended for its availability.
</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1377546796"></a>5.5.1. Form data definition languages</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377547116"></a>Introduction</h4></div></div></div><p>
		Form data structures can be defined in a <acronym class="acronym">DDL</acronym> (Data Definition Language).
		It depends very much on the application what <acronym class="acronym">DDL</acronym> is best to use.
		Users may already have their data definitions defined in a certain way.
		The form <acronym class="acronym">DDL</acronym> can be defined in the way you want. Wolframe offers a
		plugin mechanism for <acronym class="acronym">DDL</acronym> compilers and provides examples of such compilers.
		You configure the <acronym class="acronym">DDL</acronym> sources to load and the compiler to use.
	</p><p>
		With the <acronym class="acronym">DDL</acronym> form description we get a deserialization
		of some content into a structure and a serialization for the output. 
		We get also a validation and normalization procedure of the content by 
		assigning types to atomic form elements that validate and normalize 
		the data elements.
		Most of the business transactions should be doable as input form
		description, output form description and a transaction that maps
		input to output without control flow aware programming.
	</p><p>
		All types of data forms introduced here are equivalent in use for all programs.
	</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377537444"></a>Forms in simpleform DDL</h4></div></div></div><p>
		As example of a form <acronym class="acronym">DDL</acronym> we provide the <em class="glossterm">simpleform</em> <acronym class="acronym">DDL</acronym>. 
		In simple form we forms, subtructures for reuse inside structures and forms
		and includes that help you to organize your code.
	</p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377580956"></a>Commands</h5></div></div></div><p>
		The <em class="glossterm">simpleform</em> language has 3 commands:
		</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="code">FORM</code></td><td>Declare the name of the form, some document meta data and the structure that represents the description of the document content of this form</td></tr><tr><td><code class="code">STRUCT</code></td><td>Declare the name of the structure, the structure that can be referenced by name in structures of subsequent FORM or STRUCT declarations</td></tr><tr><td><code class="code">INCLUDE</code></td><td>include the file given as argument</td></tr></table><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377584068"></a>Structures</h5></div></div></div><p>
		Structures in <code class="code">FORM</code> or <code class="code">STRUCT</code> declarations
		are defined as list of elements in curly brackets '{' '}'.
	</p><p>The following example shows an empty structure declaration
	</p><pre class="programlisting">
STRUCT myStructure
{
}
	</pre><p>
	</p><p>The following example shows an empty form declaration
	</p><pre class="programlisting">
FORM myDocumentSchema
{
}
	</pre><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377586740"></a>Elements of structures</h5></div></div></div><p>
		An element in the list is either a declaration of a substructure or
		an atomic element. The elements are separated by comma ',' or end of line.
	</p><p>The following example shows a structure that is a list with 3 elements separated by end of line
		</p><pre class="programlisting">
{
    number int
    name string
    id int
}
		</pre><p>
	</p><p>And the same example with a comma as element separator
		</p><pre class="programlisting">
{
    number int, name string, id int
}
		</pre><p>
	</p><p>
		An element starts with an identifier, the name of the element.
		The name is followed by some special characters defining the element 
		attributes and the element type. The element attributes will be described
		later. The element type is either an embedded substructure in '{' '}' 
		brackets or an identifier naming an atomic type or a substructure 
		declared previously as a <code class="code">STRUCT</code>. 
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377589916"></a>Embedded structure definitions</h5></div></div></div><p>Here is an example with a embedded substructure
		</p><pre class="programlisting">
{
    number int
    name string
    address {
        street string, country string
    }
}
		</pre><p>
	</p><p>
		Embedded substructure declarations follow recursively the same rules as 
		structures defined here.
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377591468"></a>Default atomic value assignments</h5></div></div></div><p>
		Named types referencing atomic types can be followed by an assignment
		operator '=' and a string that declared a default value initialization of
		the structure element. Here is an example with a default value assignment
		</p><pre class="programlisting">
{
    number int = 1
    name string
}
		</pre><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377592836"></a>Types of atomic values</h5></div></div></div><p>
		The atomic element type names are either the reserved keyword <code class="code">string</code>
		or a type defined as sequence of <em class="glossterm">normalizer</em> functions 
		in a normalize definition file. The <em class="glossterm">normalizer</em> 
		functions assigned to a type validate the value and transform it to its 
		normalized form. The next section will explain how data types are defined.
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377594404"></a>Element attributes</h5></div></div></div><p>
		The element attributes are marked with some special characters listed and
		explained in the following table:
		</p><div class="table"><a id="idp1377594996"></a><p class="title"><strong>Table 5.15. Element attributes in simpleform</strong></p><div class="table-contents"><table summary="Element attributes in simpleform" border="1"><colgroup><col class="col1" /><col class="col2" /><col class="col3" /><col class="col4" /></colgroup><thead><tr><th> </th><th>Location</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>@</td><td>prefix of data type</td><td><code class="code">id @int</code></td><td>Expresses that the element is an attribute and not a content element of the structure. This has only influence on the XML or similar representation of the form content</td></tr><tr><td>?</td><td>prefix of data type</td><td><code class="code">value ?string</code></td><td>Expresses that the element is optional also in strict validation</td></tr><tr><td>^</td><td>prefix of form name</td><td><code class="code">ltree ^bintree</code></td><td>Expresses that the element is optional and refers to a structure defined in the same module that is expanded only if the element is present. With this construct it is possible to define recursive structures like trees.</td></tr><tr><td>!</td><td>prefix of data type</td><td><code class="code">id !int</code></td><td>Expresses that the element is always mandatory (also in non strict validation)</td></tr><tr><td>[]</td><td>suffix of data type</td><td><code class="code">values string[]</code></td><td>Expresses that the element is an array of this type</td></tr><tr><td>[]</td><td>without data type</td><td><code class="code">ar [] { }</code></td><td>Expresses this element is an array of structures and that the structure defined describes the prototype (initialization) element of the array.</td></tr><tr><td>='..'</td><td>end of data type declaration</td><td><code class="code">id int = 1</code></td><td>Expresses that '..' is the default initialization value of this element.</td></tr></tbody></table></div></div><p><br class="table-break" />
		Non contradicting attributes can be combined:
		</p><pre class="programlisting">
id ?@int = 1
		</pre><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377608564"></a>Embedding elements and inheritance</h5></div></div></div><p>
		Using a single underscore '_' as atomic element name means that the 
		atomic element is representing the unnamed content value of the structure.
		Using a single underscore for a substructure means that the substructure
		is embedded into the structure without being referenceable by name. 
		The embedding into a structure is used to express inheritance.
	</p><p>Here is an example with embedding of a named structure
		</p><pre class="programlisting">
STRUCT content
{
    name string
    birth string
}

FORM insertedContent
{
    id int
    _ content
}
		</pre><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377610388"></a>Declaring document meta data</h5></div></div></div><p>
		Document meta data in <code class="code">FORM</code> definitions are declared after the
		form declaration header and before the form structure declaration.
		A meta data declaration starts with a dash '-' followed by the meta data
		attribute name as identifier or string and the value as string.
	</p><p>Here is an example of a form with meta data declarations
		</p><pre class="programlisting">
FORM myDoc
    -root = 'doc', -schemaLocation = 'http://bla.com/schema'
{
}
		</pre><p>
	</p><p>or with end of line as attribute separator
		</p><pre class="programlisting">
FORM myDoc
    -root = 'doc'
    -schemaLocation = 'http://bla.com/schema'
{
}
		</pre><p>
	</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377613124"></a>Example form definition</h5></div></div></div><p>
		Now all elements of <em class="glossterm">simpleform</em> are explained.
		Here is an example that shows a complete form definition in <em class="glossterm">simpleform</em> <acronym class="acronym">DDL</acronym>.
		</p><pre class="programlisting">
		
FORM Customer
	-root customer
{
    ID !@int                  ; Internal customer id (mandatory)
    name string               ; Name of the customer
    canonical_Name string     ; Customer name in canonical form
    country string            ; Country
    locality ?string          ; Locality (optional)
}

		</pre><p>
	</p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1377627676"></a>5.5.2. Datatypes in DDLs</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377627996"></a>Introduction</h4></div></div></div><p>The basic elements to build atomic data types in <span class="application">Wolframe</span>
		are normalization functions. Basic normalization functions are written in C++
		and loadable as modules.
	</p><p>
		As we already mentioned are atomic elements in forms typed.
		With each type a function is associated to validate and normalize the
		atomic element of that type. There is only one predefined type called 'string'.
		strings are neither validated nor transformed for processing in any way.
		The others are defined in files with the extension <code class="code">.wnmp</code>
		that are referenced as programs in the configuration.
	</p><p>
		A <code class="code">.wnmp</code> file contains assignments of a type name to sequences 
		of basic normalization function calls where the first takes the initial input.
		A normalization function call can either be a normalizer function 
		or a custom data type defined in a module or a method of the predecessing
		custom data type in the sequence of the normalization function calls.
		The output of a function in the sequence gets the input of the next one and 
		the final output for the last one.
		Each normalization step validates the input as atomic type (arithmetic,string,etc.)
		and transforms it to another atomic type.
	</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377628628"></a>Example</h4></div></div></div><p>
		The example defines 3 numeric types including trimming of the input string for mode tolerant
		parsing and a string type that is converted to lowercase as normalization.
	</p><p>
		</p><pre class="programlisting">
		
int=trim,integer(5);
uint=trim,unsigned;
currency=trim,fixedpoint( 13, 2);
name=trim,lcname;

		</pre><p>
	</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377662556"></a>Language description</h4></div></div></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377662908"></a>Type assignments</h5></div></div></div><p>
			Each type declaration in a <code class="code">.wnmp</code> file starts with an identifier followed by an assignment 
			operator '='. The left side identifier specifies the name of the type. 
			This type name can be used in a DDL as name instead of the built-in
			type <code class="code">string</code>. 
			A token of this type is validated and normalized with the 
			comma separated sequence of normalizer references on the right side of
			the assignment. A normalizer reference consists of an identifier plus an 
			optional comma separated list of constant arguments in brackets ('(' and ')').
			The interpretation of the arguments depend on the function type. 
			An integer type for example could have the maximum number of digits 
			of the integer type.
		</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="idp1377664660"></a>Standard modules for normalizers</h5></div></div></div><p>
			There are some standard modules you can use when you define your own type system.
			They are delivered with <span class="application">Wolframe</span>:
		</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>mod_normalize_locale: Unicode string composite normalization</p></li><li class="listitem"><p>mod_normalize_string: Basic string normalization (like trim, etc.)</p></li><li class="listitem"><p>mod_normalize_base64: Base64 encoding/decoding</p></li><li class="listitem"><p>mod_datatype_datetime: Custom data type for date and time arithmetics and normalization</p></li><li class="listitem"><p>mod_datatype_bcdnumber: Custom data type for bid number arithmetics and normalization</p></li></ul></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1377667684"></a>Configuration</h4></div></div></div><p>For declaring and using a .wnmp file in our example above, we have to load 
	the module 'mod_normalize_string' and the module 'mod_normalize_number'.
	For this we add the following two lines to the LoadModules section of our <span class="application">Wolframe</span> configuration:
		</p><pre class="programlisting">
		
    Module mod_normalize_number
    Module mod_normalize_string


		</pre><p>
	</p><p>We also have to add the declaration of the program "example.wnmp" (listing example above) 
	to the Processor section of the configuration.
	</p><pre class="programlisting">
	
    Program example.wnmp

	</pre><p>
	</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk01ch05s04.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk01ch05.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk01ch05s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.4. Functions </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5.6. Filters</td></tr></table></div></div></div>

<!-- Footer -->
<div xmlns="" class="wrapper row2">
	<div id="footer" class="clear">
		<div class="one_third first">
			<h2 class="footer_title">Documentation</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/documentation.html">User documentation</a></li>
					<li><a href="/documentation.html">Developer documentation</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Downloads</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/downloads.html">Hosted on Github</a></li>
					<li><a href="/downloads.html">Packages on Sourceforge</a></li>
				</ul>
			</nav>
		</div>

		<div class="one_third">
			<h2 class="footer_title">Contact Us</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><strong>Email:</strong> <a href="/mailto:contact@wolframe.net">contact@wolframe.net</a></li>
					<li>
						<a id="googleplus-bttn" href="http://plus.google.com/116915890857205562872?prsrc=3" rel="publisher" target="_top" style="text-decoration:none;">
							<span>Google+</span></a>
						<a id="linkedin-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>LinkedIn</span></a>
						<a id="twitter-bttn" href="http://twitter.com/ProjectWolframe" target="_top" style="text-decoration:none;">
							<span>twitter</span></a>
						<a id="rss-bttn" href="#" target="_top" style="text-decoration:none;">
							<span>rss</span></a>
					</li>
					<li>
						<a href="https://twitter.com/ProjectWolframe" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @ProjectWolframe</a>
						<div class="google-follow-button"><div class="g-follow" data-annotation="none" data-height="20" data-href="http://plus.google.com/116915890857205562872" data-rel="publisher"></div></div>
						<div class="google-plusone-button"><div class="g-plusone" data-href="http://www.wolframe.net" data-size="medium"></div></div>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>

<div xmlns="" class="wrapper row4">
	<div id="copyright" class="clear">
		<p class="fl_left">Copyright © 2014 - <a href="#">Project Wolframe</a> - All Rights Reserved</p>
		<p class="fl_right"><a href="/copyright.html">Copyrights and credits</a></p>
	</div>
</div>

<!-- Scripts -->
<script xmlns="" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script xmlns="" src="http://code.jquery.com/ui/1.10.1/jquery-ui.min.js"></script>
<script xmlns="">window.jQuery || document.write('\x3Cscript src="/layout/scripts/jquery-latest.min.js"&gt;\x3C\/script&gt;\
\x3Cscript src="/layout/scripts/jquery-ui.min.js"&gt;\x3C\/script&gt;')</script>
<script xmlns="">jQuery(document).ready(function($){ $('img').removeAttr('width height'); });</script>
<script xmlns="" src="/layout/scripts/jquery-mobilemenu.min.js"></script>
<script xmlns="" src="/layout/scripts/custom.js"></script>

<!-- Google analytics tracking -->
<script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46433226-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- Tweeter follow script -->
<script xmlns="">
	!function( d, s, id )	{
		var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location)?'http':'https';
		if( !d.getElementById( id ))	{
			js = d.createElement( s );
			js.id = id;
			js.src = p + '://platform.twitter.com/widgets.js';
			fjs.parentNode.insertBefore( js,fjs );
		}
	} ( document, 'script', 'twitter-wjs' );
</script>

<!-- Google +1, follow -->
<script xmlns="" type="text/javascript">
	window.___gcfg = {
		lang: 'en-US',
		parsetags: 'onload'
	};
	( function()	{
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	}) ();
</script>

</body></html>