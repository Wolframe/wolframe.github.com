<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 3. Functions</title><link rel="stylesheet" type="text/css" href="/layout/styles/main.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Wolframe documentation" /><link rel="up" href="bk03.html" title="Building Wolframe Services" /><link rel="prev" href="bk03ch02.html" title="Chapter 2. Command Handler" /><link rel="next" href="bk03ch03s02.html" title="3.2. Implement Functions in .NET" />
	<title xmlns="">Project Wolframe</title>
	<meta xmlns="" charset="iso-8859-1" />
	<meta xmlns="" name="viewport" content="width=device-width, initial-scale=1.0" />

	<link xmlns="" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

	<link xmlns="" href="/layout/styles/main.css" rel="stylesheet" type="text/css" media="all" />
	<link xmlns="" href="/layout/styles/mediaqueries.css" rel="stylesheet" type="text/css" media="all" />

	<!--[if lt IE 9]>
		<link href="/layout/styles/ie/ie8.css" rel="stylesheet" type="text/css" media="all">
		<script src="/layout/scripts/ie/css3-mediaqueries.min.js"></script>
		<script src="/layout/scripts/ie/html5shiv.min.js"></script>
	<![endif]-->
	
<div class="wrapper row3"><div id="container"></head><body>

<div xmlns="" class="wrapper row1">
	<header id="header" class="full_width clear">
		<hgroup>
			<h1><a href="/index.html">Project Wolframe</a></h1>
			<h2>Free Responsive Template</h2>
		</hgroup>
		<div id="header-contact">
			<ul class="list none">
				<li><span class="icon-envelope"></span> <a href="mailto:contact@wolframe.net">contact@wolframe.net</a></li>
<!--				<li><span class="icon-phone"></span> +xx xxx xxxxxxxxxx</li> -->
			</ul>
		</div>
	</header>
</div>

<!-- ################################################################################################ -->
<div xmlns="" class="wrapper row2">
	<nav id="topnav">
		<ul class="clear">
			<li><a href="/index.html" title="Home">Home</a></li>
			<li><a href="/solutions.html" title="Solutions">Solutions</a></li>
			<li class="active"><a href="/downloads.html" title="Downloads">Downloads</a></li>
			<li><a href="/documentation.html" title="Documentation">Documentation</a></li>
			<li><a class="drop" title="Support">Support</a>
				<ul>
					<li><a href="/404.html" title="404 page">404</a></li>
					<li><a href="/faq.html" title="FAQ">FAQ</a></li>
					<li class="last-child"><a href="http://www.google.com/?query=free%20mailing%20lists" title="Mailing lists">Mailing lists</a></li>
				</ul>
			</li>
			<li class="last-child"><a href="/contact.html" title="Contact Us">Contact Us</a></li>
		</ul>
	</nav>
</div>
<!-- ################################################################################################ -->

<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 3. Functions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk03ch02.html">Prev</a> </td><th width="60%" align="center">Building Wolframe Services</th><td width="20%" align="right"> <a accesskey="n" href="bk03ch03s02.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idp1381513100"></a>Chapter 3. Functions</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="sect1"><a href="bk03ch03.html#idp1381557436">3.1. Database Transaction Functions (TDL)</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03.html#idp1381557804">3.1.1. Introduction</a></span></dt><dt><span class="sect2"><a href="bk03ch03.html#idp1381592012">3.1.2. Examples</a></span></dt><dd><dl><dt><span class="sect3"><a href="bk03ch03.html#idp1381592332">First</a></span></dt><dt><span class="sect3"><a href="bk03ch03.html#idp1381594300">Preprocessing Input</a></span></dt><dt><span class="sect3"><a href="bk03ch03.html#idp1381595844">Using Variables</a></span></dt><dt><span class="sect3"><a href="bk03ch03.html#idp1381597500">Operations (Subroutines)</a></span></dt></dl></dd><dt><span class="sect2"><a href="bk03ch03.html#idp1381599108">3.1.3. Language Description</a></span></dt><dd><dl><dt><span class="sect3"><a href="bk03ch03.html#idp1381599428">Keywords</a></span></dt><dt><span class="sect3"><a href="bk03ch03.html#idp1381607788">Substitutes in Commands</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="bk03ch03s02.html">3.2. Implement Functions in .NET</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03s02.html#idp1381580628">3.2.1. Introduction</a></span></dt></dl></dd><dt><span class="sect1"><a href="bk03ch03s03.html">3.3. Implement Functions in Python</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03s03.html#idp1381578268">3.3.1. Introduction</a></span></dt></dl></dd><dt><span class="sect1"><a href="bk03ch03s04.html">3.4. Implement Functions in Lua</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381624916">3.4.1. Introduction</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381658436">3.4.2. Declaring Functions</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381660716">3.4.3. Wolframe Provider Library</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381664748">3.4.4. Wolframe Global Objects</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381667788">3.4.5. Using forms</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381674428">3.4.6. Form Functions</a></span></dt><dt><span class="sect2"><a href="bk03ch03s04.html#idp1381679428">3.4.7. List of <span class="application">Lua</span> Objects</a></span></dt></dl></dd><dt><span class="sect1"><a href="bk03ch03s05.html">3.5. Defining DDL Data Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03s05.html#idp1381740508">3.5.1. Introduction</a></span></dt><dt><span class="sect2"><a href="bk03ch03s05.html#idp1381729412">3.5.2. Example</a></span></dt><dt><span class="sect2"><a href="bk03ch03s05.html#idp1381773468">3.5.3. Language Description</a></span></dt><dt><span class="sect2"><a href="bk03ch03s05.html#idp1381776084">3.5.4. Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="bk03ch03s06.html">3.6. Implement Functions in C++</a></span></dt><dd><dl><dt><span class="sect2"><a href="bk03ch03s06.html#idp1381738028">3.6.1. Introduction</a></span></dt><dt><span class="sect2"><a href="bk03ch03s06.html#idp1381765148">3.6.2. Declaring Functions</a></span></dt><dt><span class="sect2"><a href="bk03ch03s06.html#idp1381765764">3.6.3. Input/Output Data Structures</a></span></dt></dl></dd></dl></div><p>This chapter describes how functions are linked to the logic tier. It introduces a language to write
database transaction functions and a language to describe atomic data type normalizations and gives an overview
on the language bindings available for Wolframe.
</p><p>
After reading this chapter you should be able to write functions of the <span class="application">Wolframe</span> logic tier on your own.
</p><p>
Be aware that you have to configure a programming language of the logic tier in <span class="application">Wolframe</span>
before using it. Each chapter introducing a programming language will have a section that describes how the server
configuration of <span class="application">Wolframe</span> has to be extended for its availability.
</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1381557436"></a>3.1. Database Transaction Functions (TDL)</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1381557804"></a>3.1.1. Introduction</h3></div></div></div><p>
			For the description of transactions <span class="application">Wolframe</span> provides the
			transaction definition language (<acronym class="acronym">TDL</acronym>) introduced here.
			<span class="application">Wolframe</span> transactions in <acronym class="acronym">TDL</acronym> are defined as functions in a
			transactional context. This means that whatever is executed in a transaction function
			belongs by default to a transaction with an auto-commit on function completion
			if not explicitely defined otherwise by the caller.
		</p><p>
			A <acronym class="acronym">TDL</acronym> transaction function takes a structure as input and returns a structure as output.
			The <span class="application">Wolframe</span> database interface defines a transaction as context where input is passed as structure and the output is fetched from as structure.
			The TDL is a programming language to describe the building of transaction input and the building of the result structure from the database output.
			It defines a transaction as a sequence of database operations. A database operation is either a single embedded database instruction in the language of the underlaying database, a name of a procedure declared in the database or a block of operations delared with OPERATION. It adds some constructs to address input structure elements or database command results as arguments.
			Each database command result can be declared as being part of the transaction result structure.
			The language has no control structures and is therefore not a general purpose programming language.
			It just offers some mapping of input to commands and from commands results to output.
		</p><p>
			For input data conversion the transaction definition language lets you define a
			preprocessing section where wolframe functions defined can be called for selected input.
		</p><p>
			The TDL is case insensitive. For clearness and better readability TDL keywords are written in
			uppercase here.
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1381592012"></a>3.1.2. Examples</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381592332"></a>First</h4></div></div></div><p>This example selects a key from a table and uses it for an insert into a list. The substitute "$1" refers to the first column of the "SELECT id FROM UserTable .." query result. The substitute "$(name)" in the first statement refers to the toplevel element 'name' of the input. In the second statement it refers to the "name" element of the "item" selection in the query, e.g. for each element with the path "/item/name" (name beeing unique per item and item describing a set of items).
		</p><pre class="programlisting">
		
TRANSACTION insertItem
BEGIN
	INTO user
		DO UNIQUE NONEMPTY SELECT id FROM UserTable
			WHERE name = $(name);
	FOREACH item
		DO INSERT INTO ItemTable (ownerid,name)
			VALUES ($1,$(name));
END

		</pre><p>
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381594300"></a>Preprocessing Input</h4></div></div></div><p>The example selects are id's depending on a normalized name. The normalization is done in a preprocessing step
		</p><pre class="programlisting">
		
TRANSACTION selectPersonId
PREPROCESS BEGIN
	FOREACH person INTO normalizedName
		DO normalize_diachars( name );
END
BEGIN
	FOREACH person INTO user
		DO UNIQUE NONEMPTY
			SELECT id FROM UserTable
				WHERE name = $(normalizedName);
END


		</pre><p>
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381595844"></a>Using Variables</h4></div></div></div><p>The example returns the 'id' of a country depending on a normalized name. The normalization is done in a preprocessing step. The result is printed into a structure country/code;
		</p><pre class="programlisting">
		
TRANSACTION selectCountry
PREPROCESS BEGIN
	INTO country/normalizedName DO normalize_diachars( country/name );
END
BEGIN
	DO UNIQUE NONEMPTY SELECT id FROM CountryTable
		WHERE name = $(country/normalizedName);
	LET countrycode = $id;
		-- assigning the result with column name
		--   'id' to the variable 'countrycode'
	RESULT INTO country
		-- building a result block with name 'country'
	BEGIN
		INTO code PRINT $[countrycode];
		-- printing the variable 'countrycode' with tag 'code'
		--   into the 'country' result block
	END
END


		</pre><p>
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381597500"></a>Operations (Subroutines)</h4></div></div></div><p>The example calls an operation with one argument to map the output.
		</p><pre class="programlisting">
		
OPERATION selectFamilyMembers( id)
BEGIN
	INTO member
		DO SELECT surname,prename FROM PersonTable
			WHERE id = $[id];
END

TRANSACTION getFamilyMembers
BEGIN
	FOREACH person INTO . DO selectFamilyMembers( id);
END


		</pre><p>
		</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="idp1381599108"></a>3.1.3. Language Description</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381599428"></a>Keywords</h4></div></div></div><p>
			</p><table border="0" summary="Simple list" class="simplelist"><tr><td>TRANSACTION</td><td>Defines a block of statements in the following BEGIN ... END block as transaction.</td></tr><tr><td>AUTHORIZE</td><td>Followed by a pair of identifiers in '(' ')' brackets, separated by a comma. Defines the method to call for granting authorization to the caller of this transaction.</td></tr><tr><td>OPERATION</td><td>Defines a block of statements in the following BEGIN ... END block as single operation.</td></tr><tr><td>PREPROCESS</td><td>Defines a block of preprocessing statements for processing selected input and writing into the input structure for further processing.</td></tr><tr><td>BEGIN</td><td>Marks the start of an execution block (terminated by END) of a TRANSACTION or OPERATION or PREPROCESS or RESULT INTO block.</td></tr><tr><td>END</td><td>Marks the end of an execution block.</td></tr><tr><td>RESULT</td><td>Defines subsection of the result built. It is followed by a INTO and an identifier defining a relative path in result where the following block marked with BEGIN .. END is mapped to</td></tr><tr><td>FOREACH</td><td>Followed by a selection path. Defines a selection in nodes as input of the associated command. The associated command is executed for each member of the selection. All relative path expressions in the associated command arguments have the path of a selected element of the operation as base.</td></tr><tr><td>INTO</td><td>Followed by an identifier or a path that declares the result tag for each result element of the associated command</td></tr><tr><td>DO</td><td>Starts a database command or execute operation declaration. It is followed by an embedded SQL command terminated with ';' or by an operation call</td></tr><tr><td>UNIQUE</td><td>constraint on a database command or operation result: Result must be unique, if it exists</td></tr><tr><td>NONEMPTY</td><td>constraint on a database command result: Result must not be empty</td></tr><tr><td>LET</td><td>Starts a variable declaration for the current scope. Variables can refer to single database command results.</td></tr><tr><td>ON ERROR</td><td>Starts a declaration for a hint for a certain error class to enrich error messages with context information of the current operation</td></tr><tr><td>HINT</td><td>Declares an error message in an ON ERROR &lt;errclass&gt; HINT declaration</td></tr><tr><td>PRINT</td><td>Declares a print of an argument into the result context of the print declaration scope. The argument can be a variable or result reference but cannot refer to input. The print instruction can use an INTO path as well to declare a target path in the result</td></tr></table><p>
		</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="idp1381607788"></a>Substitutes in Commands</h4></div></div></div><p>
			List of Substitutes
			</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Element</td><td>Example</td><td>Description</td></tr><tr><td>$NNN</td><td>$1</td><td>Column of a row of the last result addressed by index (counted from 1 for the first column). A command containing any result reference is executed for each row of the last result</td></tr><tr><td>$columname</td><td>$id</td><td>Column of a row of last result addressed by name. A command containing any result reference is executed for each row of the last result</td></tr><tr><td>$(path)</td><td>$(person/id)</td><td>Single element addressed by relative path from the current input selection</td></tr><tr><td>$[varname]</td><td>$[id]</td><td>Variable reference refering to a single result or NULL (not a set!) previously in the same scope declared with LET varname = &lt;result column reference&gt;;</td></tr></table><p>
		</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk03ch02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk03ch03s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 2. Command Handler </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3.2. Implement Functions in .NET</td></tr></table></div>
	
<!-- Footer -->
<div xmlns="" class="wrapper row2">
	<div id="footer" class="clear">
		<div class="one_quarter first">
			<h2 class="footer_title">Solutions</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="#">Simple CRM</a></li>
					<li><a href="#">Bug reporting tool</a></li>
					<li><a href="#">Message broker</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Documentation</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="#">bla bla 1</a></li>
					<li><a href="#">bla bla 2</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Downloads</h2>
			<nav class="footer_nav">
				<ul class="nospace">
					<li><a href="/downloads_wolframe.html">Wolframe server</a></li>
					<li><a href="/downloads_wolfclient.html">Wolframe client</a></li>
				</ul>
			</nav>
		</div>
		<div class="one_quarter">
			<h2 class="footer_title">Contact Us</h2>
			<p><strong>Email:</strong> <a href="mailto:contact@wolframe.net">contact@wolframe.net</a></p>
		</div>
  </div>
</div>

<div xmlns="" class="wrapper row4">
	<div id="copyright" class="clear">
		<p class="fl_left">Copyright © 2013 - <a href="#">Project Wolframe</a> - All Rights Reserved</p>
		<p class="fl_right">Template by <a href="http://www.os-templates.com/" title="Free Website Templates">OS Templates</a></p>
	</div>
</div>

<!-- Scripts -->
<script xmlns="" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script xmlns="" src="http://code.jquery.com/ui/1.10.1/jquery-ui.min.js"></script>
<script xmlns="" src="layout/scripts/jquery-mobilemenu.min.js"></script>
<script xmlns="" src="layout/scripts/custom.js"></script>

</body></html>